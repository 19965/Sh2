#
# $Id: config 14069 2012-08-13 16:13:16Z juan $
# Sample PowerMTA configuration file
#

#
# E-mail address for mailer's administrator (please specify!)
#
postmaster you@QQQhostnameQQQ
host-name QQQhostnameQQQ
#
# IP address(es) and port(s) on which to listen for incoming SMTP connections
#
smtp-listener QQQipQQQ:QQQportQQQ     # listens on all local IPs

domain-key mykey, QQQhostnameQQQ, /etc/pmta/mykey.QQQhostnameQQQ.pem

#
# Settings per source IP address (for incoming SMTP connections)
#
<smtp-user mlilbu>
password 6iu3TY9iZUZPDF
source {pmta-auth}
</smtp-user>
<source {pmta-auth}>
smtp-service yes
always-allow-relaying yes
require-auth true
remove-received-headers true
add-received-header false
hide-message-source true
</source>

<source 127.0.0.1>
    smtp-service yes
    always-allow-relaying yes
    require-auth false
</source>




<source 0/0>                 # matches all
    log-connections no
    log-commands    no       # WARNING: verbose!
    log-data        no       # WARNING: even more verbose!
</source>

#
# SMTP users (authenticated via SMTP AUTH)
#

#
# Settings per outgoing domain
#
#<domain discard.port25.com>
#    max-smtp-out    800
#    route           [192.168.0.1]:2525  # bypasses DNS resolution
#</domain>
#
#<domain test.port25.com>
#    max-smtp-out    1
#    log-connections yes
#    log-commands    yes     # WARNING: verbose!
#    log-resolution  no      # WARNING: verbose!
#    log-data        no      # WARNING: even more verbose!
#</domain>

<domain *>
	max-smtp-out 1200
	retry-after 1s
	log-connections no
	log-commands no
	log-transfer-failures no
	deliver-local-dsn no
	dkim-sign yes
	dkim-algorithm rsa-sha256
	max-msg-per-connection unlimited
	backoff-max-connect-rate 0
	backoff-upon-all-sources-disabled true
	backoff-max-msg-rate 0/d

</domain>
#######################
domain-macro sez seznam.cz
<domain $sez>
queue-to sez.queue
</domain>
<domain sez.queue>
    route 77.75.77.90                  
    max-smtp-out 1                             
    retry-after 1d
    max-msg-rate 3/m                              
    dkim-sign yes                                
    dkim-algorithm rsa-sha256      
    use-starttls yes                            
    require-starttls no                          
</domain>
##########################################
##########    <START TELIA>  #############
##########################################
domain-macro telia telia.com
<domain $telia>
queue-to telia.queue
</domain>
<domain telia.queue>
	route 81.236.60.210
	max-smtp-out 5
	bounce-after 4d12h
	retry-after 1s
	log-connections no
	log-commands no
	log-transfer-failures no
	deliver-local-dsn no
	dkim-sign yes
	dkim-algorithm rsa-sha256
	max-msg-rate 40/m
	smtp-pattern-list cables-errors
	max-msg-per-connection unlimited
</domain>
##########################################
##########    </END TELIA>  #############

##########################################
##########    <START PTD>  #############
##########################################
domain-macro ptd ptd.net,ptdprolog.net
<domain $ptd>
queue-to ptd.queue
</domain>
<domain ptd.queue>
	route  150.136.189.171
	max-smtp-out 5
	bounce-after 4d12h
	retry-after 1s
	log-connections no
	log-commands no
	log-transfer-failures no
	deliver-local-dsn no
	dkim-sign yes
	dkim-algorithm rsa-sha256
	max-msg-rate 30/m
	smtp-pattern-list cables-errors
	max-msg-per-connection unlimited
</domain>

##########################################
##########    </END PTD>  #############


##########################################
############################################
##########   <START AVMX>   #############
domain-macro avmx nxlink.com, abingdon.net, ableadvertising.com, ablewright.com, accessvt.com, acncanada.net, acninc.net, actaccess.net, actionnet.net, adweb.net, agtelco.com, aiinc.com, aikenelectric.net, airbaud.net, airosurf.com, albanymo.net, aldersonvt.com, alpinecom.net, alpineoptions.com, amerion.com, aquasolv.net, aquatch.com, arbuckleonline.com, arczip.com, ardmore.com, ardmore.net, arkansas.net, astacalaska.net, astoriail.net, atcjet.net, atmc.net, atnet.net, atomic.net, auracom.com, austincounty.com, avicom.net, avonil.net, azboss.net, bacavalley.com, baileyseed.com, barrow.com, basec.net, bayland.net, bayspringstel.net, bctonline.com, beaconassociates.com, beebroadcasting.com, benlomand.net, bentcom.net, berk.com, besstek.net, bevcomm.net, bfisherphoto.com, bigbend.net, bigriver.net, bigsandytelco.com, bigsky.net, bitterroot.net, bjre.com, blackfoot.net, blomand.net, bluestemtelco.com, bluevalley.net, borderlandnet.net, bossig.com, brainerd.net, brazoriainet.com, brazosnet.com, bredwellfarms.com, bridgemail.com, bristolbay.com, brookover.com, brtc.net, btconline.net, burgoyne.com, bushnell.net, butler-bremer.com, butlerfairclothrealtors.com, c21gvr.com, cache.net, camelliacom.com, canby.com, canbyford.com, cannon.net, carsoncomm.com, casco.net, casscomm.com, casstel.net, catt.com, cbponterealty.com, cbtelco.com, cccomm.net, ccgmail.net, cctc.net, ccwebster.net, cecomet.net, cfaith.com, cfu.net, cgdsl.net, charleston.net, chatham.net, cherokeetel.net, chesnet.net, chouteautel.com, cimtel.net, cinergymetro.net, citcom.net, cmug.com, coastal-link.net, coastalstories.com, comcell.net, comlinkinc.net, commpluswv.net, commspeed.net, comporium.net, compuwise.net, connect2.com, connect2cp.com, connectgradd.net, connections-lct.com, continet.com, cooke.net, coppercenterak.net, corpcomm.net, cotoiltool.com, cp-tel.net, crcom.net, crcwnet.com, crockettnet.com, crom.net, crosbyironton.net, crosslake.net, crosstel.net, csinet.net, ctcak.net, ctcweb.net, ctel.net, ctelco.net, cvalaska.net, cvalley.net, cvctx.com, cvinternet.net, cvok.net, d-web.com, darientel.net, dcdi.net, dekalb.net, deskmedia.com, dhc.net, diodecom.net, direclynx.net, divcominc.net, dixieconnect.com, dmbroadband.com, dnc.net, dobsonteleco.com, dslextreme.com, dswebnet.com, dtccom.net, dtcweb.net, dteworld.com, earthgirlcomposting.com, echoicemi.com, edgcombdesign.com, edistoelectric.net, efn.org, egyptian.net, elcampochamber.com, elkhart.com, elltel.net, elpaso.net, emily.net, eotnet.net, eplus.net, epud.net, eritter.net, escwireless.com, esedona.net, esrta.com, etczone.com, evertek.net, exolo.com, fabricon.com, fairpoint.net, farmerstel.com, farmerstelecom.com, farrellvending.com, fbcom.net, firstmile.net, flashmail.com, fmtc.com, fmtc.net, fnwusers.com, fone.net, foothills.net, foryou.net, franklinvt.net, fretel.com, fridayharboryachts.com, friendlycity.net, frtci.net, ftcnet.net, ftcweb.net, ftitel.net, ftmojave.com, ganadoisd.org, gassville.net, gbta.net, gcctv.com, gcecisp.com, gcpower.net, genesteffy.com, gervais.com, gfmtlaw.com, gilanet.com, gilanet.net, glastel.net, global-instruments.com, gmavt.com, gmavt.net, gmtel.net, gofast.am, gojade.org, gorge.net, gorhamtel.com, gotown.net, gotricounty.com, gotsky.com, gpcom.net, grantcity.net, grm.net, grundyec.com, grundyec.net, gsinet.net, gtcom.net, gtec.com, gtownonline.com, gwrengineering.com, halhinet.on.ca, hamburgia.net, hancock.net, hansentrucking.net, hardynet.com, harlannet.com, hartcom.net, hawaiianisp.com, hbcomm.net, hcil.net, heathsprings.net, helixtel.com, highland.net, hintonet.net, homesc.com, hopitelecom.net, hotsprings.net, hrtc.net, htcnet.net, htcnet.org, icsofidaho.net, ilovealaska.net, imonmail.com, industryinet.com, industrytelco.com, indytel.com, infodash.com, initco.net, innercite.com, interhop.net, interrobangdesign.com, intrstar.net, ipsenault.com, islandbicycles.com, ism.net, itspeed.net, itstriangle.com, itwifi.net, jagtec.net, jancannonfilms.com, jeffbb.net, jerseycounty-il.us, jerseycountygrain.com, kalama.com, kaplantel.net, kermantel.net, kevinranker.com, kimballarts.com, kmtel.com, kohnrath.com, kpu.net, kpunet.net, ktctelecom.net, kuntrynet.com, lakefield.net, lcturbonet.com, lighthouse.net, lightstreamin.com, lighttube.net, ligtel.com, littlefalls.net, lonstel.com, lowcountry.com, lpctel.net, lrmutual.com, lusfiber.net, lvbw.net, lycomonline.com, lyn.net, macomb.com, madisontelco.com, madras.net, madriver.com, magick.net, magnessoil.com, maplecity.com, maplenet.net, marsweb.com, mbo.net, mcloudteleco.com, mepotelco.net, meyecomputer.com, mgwnet.com, michaelriddell.com, midstatesd.net, millertel.net, minn.net, mintel.net, mon-cre.net, montana.com, mowisp.net, mri-vt.com, mrtc.com, mstar.net, mtangel.net, mtaonline.net, mtcnow.net, mtintouch.net, mtnhome.com, murray-ky.net, mvtel.net, myexcel.com, mygsc.com, mymctc.net, mymetronet.net, mynewroads.com, myninestar.net, nalu.net, nehalemtel.net, netllc.net, netnet.net, netropolis.net, netsync.net, netutah.net, newflorence.com, newfrontiernv.us, newportnet.com, nickhallagency.com, nisswa.net, nltc.net, nnmt.net, nordicskater.com, nortexinfo.net, northarkansas.net, northlink.com, northtoalaska.net, norwaymi.com, norwoodlight.com, noxapatertel.net, nspor.com, ntin.net, nu-world.com, nu-z.net, nwwnet.net, ohiohills.com, oklatel.net, one-eleven.net, onecliq.net, onlinezenda.net, oolwireless.net, oregonisonline.com, ortelco.net, orwell.net, ospreynet.com, otecom.net, otz.net, our-town.com, ovalinternet.net, pacwest.net, pageworksdesign.com, palmain.com, panachesalonspa.com, parkinsonbooks.com, patriotofs.com, pawneenews.com, pbtcomm.net, pctelcom.coop, pctelcom.net, peak.org, peaksky.com, pecantreekennel.com, peggysglowingmemories.com, pemtel.com, pemtel.net, peoplescom.net, peoplestel.net, peoplestelecom.net, perfectiontrailers.com, pg-direct.net, phantomcycles.com, phonewave.net, pickperry.com, pierz.net, pineland.net, pinetel.com, pinncom.com, pioneer.net, pionnet.com, pivot.net, pixfotowerks.com, planetgrateful.com, planttel.net, platwls.com, plbb.us, pld.com, pldi.net, pmtnet.net, poka.com, polasekconstruction.com, portoflopez.com, portoforcas.com, positiverealty.com, potatoseed.com, potc.net, prairie-contractors.com, prairie.ws, precisionpartners.com, prestige-contractors.com, prigelmachine.com, progressivetel.com, pronetisp.net, proposalhelp.com, psci.net, psln.com, pstel.net, ptmc.net, ptsi.net, pvbroadband.com, pvtelephone.com, pwrtc.com, q1.net, quantumcomposers.com, ragland.net, rainbowtel.net, rainshadowsolar.com, rallstech.com, rallstech.net, rangeweb.net, rcrobertslaw.com, rcwifi.com, redcedarschool.com, redcedarschool.org, redrock.net, redwing.net, reitmeier.com, relaxationdentistrychaska.com, resortguides.us, restinglion.com, rexnet.net, rhmotorlines.com, rhtc.net, richmondvermont.com, rickmoulton.com, riflebarrels.com, ripleycountytourism.com, rittermail.com, ritternet.com, rivervoices.com, rjdance.com, rmbible.org, rmbvt.com, rmdbs.net, roadlynx.net, rockg.biz, rockisland.com, rognerealty.com, rosarioresort.com, rpt.coop, rptel.net, rrv.net, rsd.aero, rsnet.org, rtci.net, rtcol.com, rtconnect.net, rtelco.net, rtinet.com, rtmc.net, rtti.net, rurallink.net, saddlebackaz.net, salemglencc.net, sault.com, scattercreek.com, scatui.net, scientificmaterials.com, scottsboro.org, sebastiancorp.net, shadowprod.com, shawanonet.net, shawneelink.com, shawneelink.net, shtc.net, sisna.com, sisqtel.net, smartfella.com, smig.net, smt-net.com, socolo.net, speedconnect.com, speednetllc.com, spiritcom.net, spruceknob.net, sptc.net, srcaccess.net, st-tel.net, staplesnet.com, stic.net, stinternet.net, stpaultel.com, sunflowertelco.com, surry.net, svtv.com, svwireless.com, swiftaz.net, swiftwireless.com, swingpeepers.com, swnebr.net, swtexas.net, taconic.net, tarkio.net, tasmarketing.com, taylortel.com, taylortel.net, tcaexpress.net, teleclipse.net, televar.com, telisphere.com, tennesseetel.net, theroundbarn.com, thestargroup.com, thurston.com, toledotel.com, totelcom.net, toua.net, townisp.com, traceroad.net, troycable.net, truevine.net, trustcable.com, truvista.net, ttc-cmc.net, tvcconnect.net, tvn.net, united.net, unitedsky.net, uniteone.net, urhere.net, ustconline.net, valdezak.net, value.net, viser.net, volfirst.net, vtc.net, wa.net, waterfront.net.au, wbsnet.org, wccta.net, wcn.net, wctel.net, wcvt.com, web-access.net, web-ster.com, webcomet.com, westco.net, wilkes.net, winco.net, windekindfarms.com, wiredog.com, wireless111.com, wizzards.net, wmni.net, wolffdesigns.com, woodandwoodsigns.com, woodstocktel.net, worldshare.net, wtciweb.com, wvi.com, wwest.net, xpressdata.net, yadtel.net, yellville.net, yelmtel.com, ywave.com, zipnet.us, zona.net, 3-cities.com, navicom.com, 4edisp.net, 99west.com, vhtmail.net, 99webstreet.com
<domain $avmx>
queue-to avmx.queue
</domain>
<domain avmx.queue>
    route 150.136.204.204                   # The SMTP host to connect to for sending emails
    max-smtp-out 1                              # Maximum number of simultaneous SMTP connections
    retry-after 1d                              # Time to wait before retrying a failed email delivery
    dkim-sign yes                                # Whether to use DKIM (DomainKeys Identified Mail) signing for emails
    dkim-algorithm rsa-sha256      # Recommended for DKIM in modern usage because SHA-1 has known vulnerabilities.
    use-starttls yes                             # Whether to use STARTTLS to encrypt the connection if available
    require-starttls no                          # Whether to require STARTTLS; if 'no', it will proceed without encryption if not available
    max-msg-rate 50/m                       # Maximum rate of messages allowed to be sent; 'unlimited' means no limit
    max-msg-per-connection 50                    # Maximum number of messages sent per connection
    log-connections no                           # Whether to log connections; 'no' means connections are not logged
    log-commands no                              # Whether to log SMTP commands; 'no' means commands are not logged
    bounce-after 4d                           # Time after which undelivered emails will bounce back (4 days and 12 hours)
    backoff-max-msg-rate 0/d                   # Maximum message rate during backoff period (1 message per hour)
    backoff-retry-after 12h                   # Time intervals for retrying during backoff periods (first retry after 6 hours, second retry after 12 hours)
    backoff-to-normal-after-delivery no         # Whether to return to normal message rate after successful delivery
    backoff-to-normal-after 12h                  # Time to return to normal message rate after backoff period (12 hours)
    smtp-pattern-list cables-errors              # List of patterns to match for errors, with specific backoff modes applied
</domain>
############################################

############### CABLES ###################
<smtp-pattern-list cables-errors>
reply /Message blocked due to spam content in the message/ mode=backoff
reply /Spam Detected/ mode=backoff
reply /\[VI-1\]/ mode=backoff
reply /Service refused due to bad behavior/ mode=backoff
reply /Client host rejected: IP_IN_CIDR/ mode=backoff
reply /Missing reverse DNS/ mode=backoff
reply /Greylisting in action/ mode=backoff,disable-source-ip,reenable-after=15m
reply /RBL Restriction/ mode=backoff
</smtp-pattern-list>
##########################################
#



#############################################
# Port used for HTTP management interface
#############################################
############################################
http-mgmt-port 5000

http-access 127.0.0.1 monitor
http-access ::1 monitor
http-access 23.226.140.126 admin
#############################################
# Whether to run the PowerMTA deamon as root
#############################################
run-as-root no

#
# Logging file name
#
log-file /var/log/pmta/pmta.log   # logrotate is used for rotation

#
# Accounting file(s)
#
<acct-file /var/log/pmta/acct.csv>
#    move-to /opt/myapp/pmta-acct   # configure as fit for your application
    move-interval 5m
    max-size 50M
    delete-after 8d
</acct-file>

<acct-file /var/log/pmta/b.csv>
    records b
</acct-file>

# default bounce categorization patterns
<bounce-category-patterns>
    /spam/ spam-related
    /junk mail/ spam-related
    /blacklist/ spam-related
    /blocked/ spam-related
    /\bU\.?C\.?E\.?\b/ spam-related
    /\bAdv(ertisements?)?\b/ spam-related
    /unsolicited/ spam-related
    /\b(open)?RBL\b/ spam-related
    /realtime blackhole/ spam-related
    /http:\/\/basic.wirehub.nl\/blackholes.html/ spam-related
    /\bvirus\b/ virus-related
    /message +content/ content-related
    /content +rejected/ content-related
    /quota/ quota-issues
    /limit exceeded/ quota-issues
    /mailbox +(is +)?full/ quota-issues
    /sender ((verify|verification) failed|could not be verified|address rejected|domain must exist)/ invalid-sender
    /unable to verify sender/ invalid-sender
    /requires valid sender domain/ invalid-sender
    /bad sender's system address/ invalid-sender
    /No MX for envelope sender domain/ invalid-sender
    /^[45]\.4\.4/ routing-errors
    /no mail hosts for domain/ invalid-sender
    /Your domain has no(t)? DNS\/MX entries/ invalid-sender
    /REQUESTED ACTION NOT TAKEN: DNS FAILURE/ invalid-sender
    /Domain of sender address/ invalid-sender
    /return MX does not exist/ invalid-sender
    /Invalid sender domain/ invalid-sender
    /Verification failed/ invalid-sender
    /\bstorage\b/ quota-issues
    /(user|mailbox|recipient|rcpt|local part|address|account|mail drop|ad(d?)ressee) (has|has been|is)? *(currently|temporarily +)?(disabled|expired|inactive|not activated)/ inactive-mailbox
    /(conta|usu.rio) inativ(a|o)/ inactive-mailbox
    /Too many (bad|invalid|unknown|illegal|unavailable) (user|mailbox|recipient|rcpt|local part|address|account|mail drop|ad(d?)ressee)/ other
    /(No such|bad|invalid|unknown|illegal|unavailable) (local +)?(user|mailbox|recipient|rcpt|local part|address|account|mail drop|ad(d?)ressee)/ bad-mailbox
    /(user|mailbox|recipient|rcpt|local part|address|account|mail drop|ad(d?)ressee) +(\S+@\S+ +)?(not (a +)?valid|not known|not here|not found|does not exist|bad|invalid|unknown|illegal|unavailable)/ bad-mailbox
    /\S+@\S+ +(is +)?(not (a +)?valid|not known|not here|not found|does not exist|bad|invalid|unknown|illegal|unavailable)/ bad-mailbox
    /no mailbox here by that name/ bad-mailbox
    /my badrcptto list/ bad-mailbox
    /not our customer/ bad-mailbox
    /no longer (valid|available)/ bad-mailbox
    /Recipient address rejected/ bad-mailbox
    /have a \S+ account/ bad-mailbox
    /\brelay(ing)?/ relaying-issues
    /domain (retired|bad|invalid|unknown|illegal|unavailable)/ bad-domain
    /domain no longer in use/ bad-domain
    /domain (\S+ +)?(is +)?obsolete/ bad-domain
    /denied/ policy-related
    /prohibit/ policy-related
    /refused/ policy-related
    /allowed/ policy-related
    /banned/ policy-related
    /policy/ policy-related
    /suspicious activity/ policy-related
    /bad sequence/ protocol-errors
    /syntax error/ protocol-errors
    /\broute\b/ routing-errors
    /\bunroutable\b/ routing-errors
    /\bunrouteable\b/ routing-errors
    /Invalid 7bit DATA/ content-related
    /^2.\d+.\d+;/ success
    /^[45]\.1\.[1346];/ bad-mailbox
    /^[45]\.1\.2/ bad-domain
    /^[45]\.1\.[78];/ invalid-sender
    /^[45]\.2\.0;/ bad-mailbox
    /^[45]\.2\.1;/ inactive-mailbox
    /^[45]\.2\.2;/ quota-issues
    /^[45]\.3\.3;/ content-related
    /^[45]\.3\.5;/ bad-configuration
    /^[45]\.4\.1;/ no-answer-from-host
    /^[45]\.4\.2;/ bad-connection
    /^[45]\.4\.[36];/ routing-errors
    /^[45]\.4\.7;/ message-expired
    /^[45]\.5\.3;/ policy-related
    /^[45]\.5\.\d+;/ protocol-errors
    /^[45]\.6\.\d+;/ content-related
    /^[45]\.7\.[012];/ policy-related
    /^[45]\.7\.7;/ content-related
    // other    # catch-all
</bounce-category-patterns>

#
# Spool directories
#
<spool /var/spool/pmta>
    deliver-only no
</spool>

# EOF
